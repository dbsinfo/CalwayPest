@page
@model CalwayPest.Web.Pages.DashboardModel
@{Layout = null;}
<!DOCTYPE html><html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard - Calway Pest Control</title>
<link href="fonts/fonts.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
html{scroll-behavior:auto !important;}
body{overflow-anchor:none;margin:0;padding:0;font-family:'Open Sans', sans-serif;background-color:#f5f5f5;}

/* Header */
.header{background-color:#ffffff;padding:20px 0;box-shadow:0 2px 4px rgba(0,0,0,0.1);position:sticky;top:0;z-index:100;}
.header-content{max-width:1240px;margin:0 auto;padding:0 16px;display:flex;align-items:center;justify-content:space-between;}
.logo-container img{max-width:350px;height:auto;}
.nav-buttons{display:flex;gap:15px;align-items:center;}
.nav-btn{background-color:#4A6B4F;color:#fff;padding:10px 20px;border:none;border-radius:5px;cursor:pointer;text-decoration:none;display:inline-block;font-size:14px;}
.nav-btn:hover{background-color:#3a5a3f;}
.logout-btn{background-color:#fc5185;color:#fff;padding:10px 20px;border:none;border-radius:5px;cursor:pointer;text-decoration:none;display:inline-block;}
.logout-btn:hover{background-color:#d63163;}

/* Main Content */
.main-content{max-width:1400px;margin:40px auto;padding:0 20px;}
.page-title{color:#4A6B4F;margin-bottom:30px;text-align:center;font-size:32px;}

/* Stats Cards */
.stats-container{display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:20px;margin-bottom:40px;}
.stat-card{background:#ffffff;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1);padding:25px;text-align:center;}
.stat-card h3{color:#666;font-size:14px;font-weight:500;margin:0 0 10px 0;text-transform:uppercase;}
.stat-card .stat-value{color:#4A6B4F;font-size:36px;font-weight:700;margin:0;}
.stat-card.total-revenue .stat-value{color:#00b090;}
.stat-card.paid-invoices .stat-value{color:#4A6B4F;}
.stat-card.pending-invoices .stat-value{color:#f39c12;}

/* Chart Container */
.chart-container{background:#ffffff;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1);padding:30px;margin-bottom:30px;}
.chart-title{color:#4A6B4F;font-size:20px;font-weight:600;margin-bottom:20px;text-align:center;}
.chart-wrapper{position:relative;height:400px;}

/* Filters */
.filters{background:#ffffff;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1);padding:20px;margin-bottom:30px;display:flex;gap:15px;align-items:flex-end;flex-wrap:wrap;}
.filter-group{flex:1;min-width:150px;}
.filter-group label{display:block;margin-bottom:8px;color:#333;font-weight:500;font-size:14px;}
.filter-group select,.filter-group input{width:100%;padding:10px;border:1px solid #ddd;border-radius:5px;font-size:14px;}
.filter-btn{background-color:#4A6B4F;color:#fff;padding:10px 25px;border:none;border-radius:5px;cursor:pointer;font-size:14px;height:42px;}
.filter-btn:hover{background-color:#3a5a3f;}

/* Responsive */
@@media (max-width: 768px) {
    .logo-container img{max-width:208px;}
    .nav-buttons{flex-direction:column;gap:10px;}
    .stats-container{grid-template-columns:1fr;}
    .chart-wrapper{height:300px;}
    .filters{flex-direction:column;align-items:stretch;}
    .filter-group{width:100%;}
}
</style>
</head>
<body>
<!-- Header -->
<header class="header">
    <div class="header-content">
        <div class="logo-container">
            <a href="/">
                <img src="../assets.zyrosite.com/cdn-cgi/image/format=auto,w=768,fit=crop,q=95/mjE7pQKNg6tZrakl/pest-control-logo-name-in-one-line-YrDJv9KQpbFRbnKV.png" alt="Calway Pest Control logo" />
            </a>
        </div>
        <div class="nav-buttons">
            <a href="/Dashboard" class="nav-btn">Dashboard</a>
            <a href="/InvoiceList" class="nav-btn">Invoices</a>
            <a href="/Invoice" class="nav-btn">Create Invoice</a>
            <form method="post" asp-page-handler="Logout" style="display:inline;">
                <button type="submit" class="logout-btn">Logout</button>
            </form>
        </div>
    </div>
</header>

<!-- Main Content -->
<div class="main-content">
    <h1 class="page-title">Dashboard</h1>

    <!-- Statistics Cards -->
    <div class="stats-container">
        <div class="stat-card total-revenue">
            <h3>Total Revenue</h3>
            <p class="stat-value">₹@Model.TotalRevenue.ToString("N2")</p>
        </div>
        <div class="stat-card paid-invoices">
            <h3>Paid Invoices</h3>
            <p class="stat-value">@Model.PaidInvoiceCount</p>
        </div>
        <div class="stat-card pending-invoices">
            <h3>Pending Invoices</h3>
            <p class="stat-value">@Model.PendingInvoiceCount</p>
        </div>
        <div class="stat-card">
            <h3>Total Invoices</h3>
            <p class="stat-value">@Model.TotalInvoiceCount</p>
        </div>
    </div>

    <!-- Filters -->
    <div class="filters">
        <div class="filter-group">
            <label for="dateRange">Date Range</label>
            <select id="dateRange" onchange="updateChart()">
                <option value="7">Last 7 Days</option>
                <option value="30" selected>Last 30 Days</option>
                <option value="90">Last 90 Days</option>
                <option value="365">Last Year</option>
            </select>
        </div>
        <div class="filter-group">
            <label for="chartType">Chart Type</label>
            <select id="chartType" onchange="updateChartType()">
                <option value="line">Line Chart</option>
                <option value="bar" selected>Bar Chart</option>
            </select>
        </div>
    </div>

    <!-- Sales Chart -->
    <div class="chart-container">
        <h2 class="chart-title">Daily Sales</h2>
        <div class="chart-wrapper">
            <canvas id="salesChart"></canvas>
        </div>
    </div>
</div>

<script>
    // Sales data from server
    const salesData = @Html.Raw(Model.SalesChartDataJson);
    
    let chart = null;
    let currentChartType = 'bar';
    let currentDays = 30;

    function initChart() {
        const ctx = document.getElementById('salesChart').getContext('2d');
        
        chart = new Chart(ctx, {
            type: currentChartType,
            data: {
                labels: salesData.map(d => d.date),
                datasets: [{
                    label: 'Sales Amount (₹)',
                    data: salesData.map(d => d.amount),
                    backgroundColor: currentChartType === 'bar' ? 'rgba(74, 107, 79, 0.7)' : 'rgba(74, 107, 79, 0.2)',
                    borderColor: 'rgba(74, 107, 79, 1)',
                    borderWidth: 2,
                    fill: currentChartType === 'line',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return 'Sales: ₹' + context.parsed.y.toFixed(2);
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return '₹' + value.toLocaleString();
                            }
                        }
                    }
                }
            }
        });
    }

    function updateChartType() {
        currentChartType = document.getElementById('chartType').value;
        if (chart) {
            chart.destroy();
        }
        initChart();
    }

    function updateChart() {
        currentDays = parseInt(document.getElementById('dateRange').value);
        // Reload page with new date range
        window.location.href = '/Dashboard?days=' + currentDays;
    }

    // Initialize chart on page load
    document.addEventListener('DOMContentLoaded', function() {
        initChart();
    });
</script>
</body>
</html>
